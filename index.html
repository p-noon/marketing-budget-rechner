<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketing-Budget-Rechner</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, sans-serif;
  background: #f4f4f6;
  padding: 20px;
}
.budget-calculator {
  max-width: 950px;
  margin: 40px auto;
  background: #fff;
  border-radius: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  padding: 32px;
  color: #1c1c1e;
}
h2 { text-align: center; font-size: 1.8rem; margin-bottom: 6px; }
.subtitle { text-align: center; color: #666; margin-bottom: 24px; }
.input-grid { display: flex; gap: 24px; flex-wrap: wrap; }
.column { flex: 1; min-width: 280px; }
label { font-size: 0.9rem; color: #444; display: block; margin-bottom: 6px; margin-top: 12px; }
input { padding: 10px; border: 1px solid #d2d2d7; border-radius: 10px; font-size: 1rem; background: #f9f9f9; width: 100%; box-sizing: border-box; transition: all 0.2s; }
input:focus { outline: none; border-color: #0071e3; background: white; box-shadow: 0 0 0 2px rgba(0,113,227,0.1); }
.info { font-size: 0.85rem; color: #0071e3; margin-top: 6px; }
.button-main { margin-top: 30px; width: 100%; background: #0071e3; color: white; font-weight: 600; border: none; border-radius: 14px; padding: 14px; font-size: 1.1rem; cursor: pointer; transition: background 0.2s; }
.button-main:hover { background: #0a84ff; }
.results { margin-top: 30px; text-align: center; display: none; }
.result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.result-card { background: #f5f5f7; padding: 16px; border-radius: 16px; }
.result-card.highlight { background: #e8f0fe; box-shadow: 0 0 0 2px #0071e3 inset; }
.result-card h1 { margin: 6px 0; font-size: 1.8rem; }
canvas { margin-top: 20px; width: 100%; }
.warning { color: #d70015; font-weight: 600; margin-top: 10px; }
footer { text-align: center; margin-top: 20px; font-size: 13px; color: #999; }
footer a { color: #0071e3; text-decoration: none; }
footer a:hover { text-decoration: underline; }
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 999; }
.overlay-content { background: white; padding: 24px; border-radius: 16px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
.overlay-content textarea { width: 100%; height: 120px; font-family: monospace; border-radius: 8px; border: 1px solid #ccc; padding: 8px; }
.close-btn { background: #0071e3; color: white; border: none; padding: 8px 16px; border-radius: 8px; margin-top: 12px; cursor: pointer; }
.close-btn:hover { background: #0a84ff; }

/* ðŸ“± Mobile Anpassung */
@media(max-width:600px){
  .result-grid { grid-template-columns: 1fr; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="budget-calculator">
  <h2>Marketing-Budget-Rechner</h2>
  <p class="subtitle">Berechne, welches Budget du brauchst â€“ und wie sich dein Gewinn bei unterschiedlichem Werbeeinsatz verÃ¤ndert.</p>

  <div class="input-grid">
    <div class="column">
      <h3>Grunddaten</h3>
      <label>Bruttoumsatz pro Bestellung (in â‚¬)</label>
      <input id="revenueGross" type="text" placeholder="z. B. 60">
      <label>Netto-Umsatz (berechnet)</label>
      <input id="revenueNet" type="text" readonly style="background:#f0f0f0;">
      <label>Variable Kosten (Produktion + Versand, in â‚¬)</label>
      <input id="variableCost" type="text" placeholder="z. B. 30">
      <div id="netProfitInfo" class="info"></div>
    </div>

    <div class="column">
      <h3>Szenario</h3>
      <label>Fixkosten extern (z. B. Agentur, Tools, in â‚¬)</label>
      <input id="fixedCost" type="text" placeholder="z. B. 1000">
      <label>ROAS</label>
      <input id="roas" type="text" placeholder="z. B. 3">
    </div>
  </div>

  <button class="button-main" onclick="calcBudget()">Berechnen</button>

  <div class="results" id="results">
    <div class="result-grid">
      <div class="result-card highlight">
        <p><strong>Profit pro Werbe-Euro</strong></p>
        <h1 id="profitPerEuro">â€“</h1>
      </div>
      <div class="result-card">
        <p><strong>BenÃ¶tigtes Werbebudget (Break-Even)</strong></p>
        <h1 id="neededBudget">â€“</h1>
      </div>
    </div>
    <p id="warning" class="warning"></p>
    <canvas id="budgetChart"></canvas>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>ðŸ”— Rechner einbetten / teilen</strong></a> â€“ entwickelt von 
    <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h3>Einbettungscode:</h3>
    <textarea readonly><iframe src="https://p-noon.github.io/marketing-budget-rechner" width="100%" height="950" style="border:none;"></iframe></textarea>
    <button class="close-btn" onclick="closeOverlay()">SchlieÃŸen</button>
  </div>
</div>

<script>
let chart;

// ---- Zahlformatierung ----
function parseNum(v){return parseFloat(v.replace(/\./g,"").replace(",",".").replace(/[^\d.-]/g,""))||0;}
function fmt(num,dec=2){return isFinite(num)?num.toLocaleString("de-DE",{minimumFractionDigits:dec,maximumFractionDigits:dec}):"â€“";}

// ---- Netto Ertrag aktualisieren ----
function updateNetto(){
  const gross=parseNum(document.getElementById("revenueGross").value);
  const variable=parseNum(document.getElementById("variableCost").value);
  const net=gross/1.19;
  const ertrag=net-variable;
  document.getElementById("revenueNet").value = gross?fmt(net,2)+" â‚¬":"";
  document.getElementById("netProfitInfo").innerText = gross?`Netto-Ertrag pro Bestellung: ${fmt(ertrag,2)} â‚¬`:"";
}

// ---- Budget berechnen ----
function calcBudget(){
  const gross=parseNum(document.getElementById("revenueGross").value);
  const variable=parseNum(document.getElementById("variableCost").value);
  const roas=parseNum(document.getElementById("roas").value);
  const fixed=parseNum(document.getElementById("fixedCost").value);

  const net=gross/1.19;
  const profitPerOrder=net-variable;
  const profitPerEuro=(profitPerOrder/gross)*roas-1;

  document.getElementById("results").style.display="block";
  document.getElementById("profitPerEuro").innerText=fmt(profitPerEuro);

  let neededBudget=0;
  let warning="";
  let maxBudget=10000;

  if(fixed<=0){
    warning= profitPerEuro>0?"Du machst ab dem ersten Euro Gewinn!":"Auch bei geringen Fixkosten machst du Verlust.";
  } else if(profitPerEuro<=0){
    warning="Unter dem aktuellen ROAS wird Verlust generiert.";
  } else {
    neededBudget=fixed/profitPerEuro;
    document.getElementById("neededBudget").innerText=fmt(neededBudget)+" â‚¬";
    maxBudget=neededBudget*2;
  }

  if(profitPerEuro<=0) document.getElementById("neededBudget").innerText="-";
  document.getElementById("warning").innerText=warning;

  const budgets=[], profits=[];
  for(let i=0;i<=maxBudget;i+=500){
    budgets.push(i);
    profits.push(i*profitPerEuro-fixed);
  }

  drawChart(budgets,profits);
}

// ---- Chart zeichnen ----
function drawChart(budgets,profits){
  const ctx=document.getElementById('budgetChart').getContext('2d');
  if(chart) chart.destroy();

  const isMobile=window.innerWidth<=600;
  const chartHeight=isMobile?250:350;
  document.getElementById('budgetChart').height=chartHeight;

  chart=new Chart(ctx,{
    type:'line',
    data:{
      labels:budgets.map(b=>b.toLocaleString('de-DE')),
      datasets:[{
        label:'Gewinn',
        data:profits,
        borderColor:'#0071e3',
        borderWidth:2,
        fill:false,
        pointRadius:0,
        tension:0.15
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:!isMobile,
      interaction:{mode:'nearest',intersect:false},
      plugins:{legend:{display:false}},
      scales:{
        x:{
          title:{display:true,text:'Marketingbudget (â‚¬)'},
          ticks:{autoSkip:true,maxTicksLimit:6}
        },
        y:{
          title:{display:true,text:'Gewinn (â‚¬)'},
          ticks:{callback: val => fmt(val,0)},
          grid:{color: ctx=>ctx.tick.value===0?'#d70015':'#ddd',lineWidth: ctx=>ctx.tick.value===0?2:1}
        }
      }
    }
  });
}

// ---- Overlay ----
function closeOverlay(){document.getElementById("overlay").style.display="none";}
document.getElementById("embedLink").addEventListener("click",e=>{e.preventDefault();document.getElementById("overlay").style.display="flex";});

// ---- Input Listener fÃ¼r Formatierung ----
document.querySelectorAll('#revenueGross,#variableCost,#fixedCost,#roas')
  .forEach(el=>{
    el.addEventListener('blur',()=>{el.value=fmt(parseNum(el.value),2).replace(",00","");});
    el.addEventListener('input',()=>{updateNetto();});
  });

// Initial
updateNetto();
</script>

</body>
</html>
